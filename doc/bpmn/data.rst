数据
====

数据对象
------------

数据对象存在于流程级别，除非明确指示（即数据对象与任务之间有一行），否则对单个任务不可见。

所有工作流都有 :code:`data` 属性, 例如 :code:`Task.data`, 它只是一个字典，数据对象的值存储在这里。

如果要使数据对象可用于任务，则会在任务变为之前立即将值从工作流数据复制到任务数据中 :code:`READY`;
任务完成后，数据对象值将从任务数据中删除。

如果要将值写入数据对象，则该值将存储在工作流数据中，并在任务完成时从任务数据中删除。

数据对象始终可用于网关（即使不能在图上画线）。

数据输入和输出
-----------------------

在复杂的工作流程中，能够指定所需的数据输入和输出是很有用的，特别是对于呼叫活动，因为它们是外部的，并且可能在许多不同的流程中共享。

当您将数据输入添加到呼叫活动中时，SpiffWorkflow将检查是否可以将具有该名称的变量复制到活动中，并*仅复制*您指定为输入的变量。
添加数据输出时，SpiffWorkflow将在流程结束时*仅复制*您从呼叫活动中指定的变量。如果缺少任何变量，SpiffWorkflow将引发错误。

我们的产品定制呼叫活动 (:bpmn:`call_activity.bpmn`) 不需要任何输入，但过程的输出是产品名称和数量。我们可以为这些添加相应的数据输出。

如果您使用此呼叫活动的备用版本(:bpmn:`data_output.bpmn`) 并选择具有自定义项的产品，当您在“呼叫活动”完成后检查数据时，您会看到自定义项已被删除。

要加载此示例（产品D有两个自定义项）：

.. code-block:: console

    ./runner.py -e spiff_example.spiff.file add -p order_product \
        -b bpmn/tutorial/{top_level,data_output}.bpmn \
        -d bpmn/tutorial/{shipping_costs,product_prices}.dmn

.. note::

   BPMN规范允许*any*任务具有数据输入和输出。我们的建模器没有提供将它们添加到任意任务中的方法，
但如果它们存在于BPMN XML中，SpiffWorkflow将在任何任务中识别它们。

